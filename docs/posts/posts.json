[
  {
    "path": "posts/2021-12-03-protecting-whales-from-ships/",
    "title": "Protecting Whales From Ships",
    "description": "A vessel speed reduction zone is a potential solution to reducing ship strikes with whales near Dominica. The goal of this   analysis is to look at sperm whale sighting data, and AIS vessel data, to determine a vessel speed reduction zone, and the effects implementing a vessel speed reduction zone would have on shipping activities in the zone.",
    "author": [
      {
        "name": "Cullen Molitor",
        "url": {}
      }
    ],
    "date": "2021-12-03",
    "categories": [],
    "contents": "\r\nHomework # 3\r\nProtecting Whales From Ships\r\nGroup # 2\r\nCullen Molitor\r\nAmber McEldowney\r\nSetup\r\nImport Modules\r\nimport geopandas as gpd \r\nimport rasterio as rio\r\nfrom rasterio.plot import show\r\nimport numpy as np\r\nimport pandas as pd\r\nimport matplotlib.image as mpimg\r\nimport matplotlib.pyplot as plt\r\nimport os\r\nimport glob\r\nimport contextily as ctx\r\nimport shapely\r\nfrom shapely.geometry import Polygon\r\n%matplotlib inline\r\nParameters\r\nshoreline_shapefile  = 'data/dominica/dma_admn_adm0_py_s1_dominode_v2.shp'\r\nwhales_CSV           = 'data/sightings2005_2018.csv'\r\nvessels_CSV          = 'data/station1249.csv'\r\nConstants\r\nten_kn_in_ms = 5.14\r\nprojected_EPSG = 2002   # Dominica 1945 / British West Indies Grid\r\ngeodetic_EPSG  = 4326   # WGS 84 (use as default CRS for incoming latlon)\r\nLoad Dominica Shape File\r\ndominica_shp = gpd.read_file(shoreline_shapefile)\r\ndominica_shp.head()\r\n\r\n\r\n    .dataframe tbody tr th:only-of-type {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .dataframe tbody tr th {\r\n        vertical-align: top;\r\n    }\r\n\r\n    .dataframe thead th {\r\n        text-align: right;\r\n    }\r\n\r\n\r\n\r\nADM0_PCODE\r\n\r\n\r\nADM0_EN\r\n\r\n\r\ngeometry\r\n\r\n\r\n0\r\n\r\n\r\nDM\r\n\r\n\r\nDominica\r\n\r\n\r\nPOLYGON ((-61.43023 15.63952, -61.43019 15.639…\r\n\r\n\r\nInspect CRS\r\ndominica_shp.crs\r\n<Geographic 2D CRS: EPSG:4326>\r\nName: WGS 84\r\nAxis Info [ellipsoidal]:\r\n- Lat[north]: Geodetic latitude (degree)\r\n- Lon[east]: Geodetic longitude (degree)\r\nArea of Use:\r\n- name: World.\r\n- bounds: (-180.0, -90.0, 180.0, 90.0)\r\nDatum: World Geodetic System 1984 ensemble\r\n- Ellipsoid: WGS 84\r\n- Prime Meridian: Greenwich\r\nSet CRS\r\nEPSG 2002\r\ndominica_shp = dominica_shp.to_crs(projected_EPSG)\r\ndominica_shp.crs\r\n<Projected CRS: EPSG:2002>\r\nName: Dominica 1945 / British West Indies Grid\r\nAxis Info [cartesian]:\r\n- E[east]: Easting (metre)\r\n- N[north]: Northing (metre)\r\nArea of Use:\r\n- name: Dominica - onshore.\r\n- bounds: (-61.55, 15.14, -61.2, 15.69)\r\nCoordinate Operation:\r\n- name: British West Indies Grid\r\n- method: Transverse Mercator\r\nDatum: Dominica 1945\r\n- Ellipsoid: Clarke 1880 (RGS)\r\n- Prime Meridian: Greenwich\r\nPlot Dominica\r\nfig, ax = plt.subplots(figsize=(5, 5))\r\nax.grid(True, color = 'dimgray')\r\nax.set(ylim=(1.67e6,1.74e6), xlim=(445000, 490000))\r\nax.ticklabel_format(scilimits =  [-5, 5])\r\ndominica_shp.plot(ax = ax, edgecolor = \"k\", facecolor=\"None\")\r\nctx.add_basemap(ax, crs=projected_EPSG)\r\npngLoad Whale Sightings Data\r\nwhales = gpd.read_file(whales_CSV)\r\nwhales\r\n\r\n\r\n    .dataframe tbody tr th:only-of-type {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .dataframe tbody tr th {\r\n        vertical-align: top;\r\n    }\r\n\r\n    .dataframe thead th {\r\n        text-align: right;\r\n    }\r\n\r\n\r\n\r\nfield_1\r\n\r\n\r\nGPStime\r\n\r\n\r\nLat\r\n\r\n\r\nLong\r\n\r\n\r\ngeometry\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n2005-01-15 07:43:27\r\n\r\n\r\n15.36977117\r\n\r\n\r\n-61.49328433\r\n\r\n\r\nNone\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n2005-01-15 08:07:13\r\n\r\n\r\n15.3834075\r\n\r\n\r\n-61.503702\r\n\r\n\r\nNone\r\n\r\n\r\n2\r\n\r\n\r\n2\r\n\r\n\r\n2005-01-15 08:31:17\r\n\r\n\r\n15.38106333\r\n\r\n\r\n-61.50486067\r\n\r\n\r\nNone\r\n\r\n\r\n3\r\n\r\n\r\n3\r\n\r\n\r\n2005-01-15 09:19:10\r\n\r\n\r\n15.33532083\r\n\r\n\r\n-61.46858117\r\n\r\n\r\nNone\r\n\r\n\r\n4\r\n\r\n\r\n4\r\n\r\n\r\n2005-01-15 10:08:00\r\n\r\n\r\n15.294224\r\n\r\n\r\n-61.45318517\r\n\r\n\r\nNone\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n4888\r\n\r\n\r\n4888\r\n\r\n\r\n2018-05-25 12:01:25\r\n\r\n\r\n15.39195\r\n\r\n\r\n-61.572\r\n\r\n\r\nNone\r\n\r\n\r\n4889\r\n\r\n\r\n4889\r\n\r\n\r\n2018-05-25 13:08:29\r\n\r\n\r\n15.4189\r\n\r\n\r\n-61.5833\r\n\r\n\r\nNone\r\n\r\n\r\n4890\r\n\r\n\r\n4890\r\n\r\n\r\n2018-05-25 14:50:00\r\n\r\n\r\n15.443483\r\n\r\n\r\n-61.60995\r\n\r\n\r\nNone\r\n\r\n\r\n4891\r\n\r\n\r\n4891\r\n\r\n\r\n2018-05-25 15:57:34\r\n\r\n\r\n15.499866\r\n\r\n\r\n-61.638333\r\n\r\n\r\nNone\r\n\r\n\r\n4892\r\n\r\n\r\n4892\r\n\r\n\r\n2018-05-25 16:17:10\r\n\r\n\r\n15.494783\r\n\r\n\r\n-61.6482\r\n\r\n\r\nNone\r\n\r\n\r\n4893 rows × 5 columns\r\n\r\n\r\nCreate GeoDataFrame\r\npoints = gpd.points_from_xy(whales['Long'], whales['Lat'], crs = geodetic_EPSG)\r\nwhales_gdf = gpd.GeoDataFrame(whales, geometry = points)\r\nSet CRS\r\nwhales_gdf = whales_gdf.to_crs(projected_EPSG)\r\nPlot Whale Sightings\r\nfig, ax = plt.subplots(figsize = (10, 10))\r\nax.set_aspect('equal')\r\nax.grid(True, color = 'dimgray')\r\nax.set(xlim=(4e5, 5e5), ylim=(1.5e6, 1.8e6))\r\ndominica_shp.plot(ax = ax, color='None', edgecolor = \"k\")\r\nwhales_gdf.plot(ax = ax, markersize = .1, color = \"purple\", alpha = .25)\r\nax.set_title('Whale Sightings', fontsize=12)\r\nax.ticklabel_format(scilimits =  [-5, 5])\r\nctx.add_basemap(ax, crs = projected_EPSG)\r\npngCreate Grid\r\nxmin, ymin, xmax, ymax = whales_gdf.total_bounds\r\ncell_size = 2000\r\nxs = list(np.arange(xmin, xmax + cell_size, cell_size))\r\nys = list(np.arange(ymin, ymax + cell_size, cell_size))\r\ndef make_cell(x, y, cell_size):\r\n    ring = [\r\n        (x, y),\r\n        (x + cell_size, y),\r\n        (x + cell_size, y + cell_size),\r\n        (x, y + cell_size)\r\n    ]\r\n    cell = shapely.geometry.Polygon(ring)\r\n    return cell\r\ncells = []\r\nfor x in xs:\r\n    for y in ys:\r\n        cell = make_cell(x, y, cell_size)\r\n        cells.append(cell)\r\nCreate GeoDataFrame\r\ngrid = gpd.GeoDataFrame({'geometry': cells}, crs = geodetic_EPSG)\r\nSet CRS\r\ngrid = grid.set_geometry(crs = projected_EPSG, col = grid['geometry'])\r\nPlot Grid\r\ngrid.plot(facecolor = \"none\", figsize = (10, 10), linewidth = 1)\r\n<AxesSubplot:>\r\npngExtract Whale Habitat\r\nwhale_grid = grid.sjoin(whales_gdf, how=\"inner\")\r\nPlot Whale Grid\r\nwhale_grid.plot(facecolor = \"none\", figsize = (10, 10), linewidth = .75)\r\n<AxesSubplot:>\r\npngSummarise Whale Counts\r\ngrid['count'] = whale_grid.groupby(whale_grid.index).count()['index_right']\r\nFind Primary Whale Habitat\r\ngrid = grid[grid['count'] > 20]\r\nPlot Whale Habitat\r\ngrid.plot(facecolor = \"none\", figsize = (10, 10), linewidth = .75)\r\n<AxesSubplot:>\r\npngCreate Unary Union\r\ngrid_union = grid.unary_union\r\ngrid_union\r\nsvgCreate Vessel Speed Reduction Zone\r\nThe vessel speed reduction zone is determined by the whale habitat areas in which more than 20 whales were observed per 2,000 m².\r\ngrid_convex = grid_union.convex_hull\r\ngrid_convex\r\nsvgMake GeoDataFrame\r\nwhale_habitat = gpd.GeoDataFrame(index = [0], geometry = [grid_convex], crs = projected_EPSG)\r\nPlot Whale Habitat\r\nfig, ax = plt.subplots(figsize = (10, 10))\r\nax.grid(True, color = 'dimgray')\r\nax.set(xlim=(4.4e5, 4.85e5), ylim=(1.675e6, 1.73e6))\r\ndominica_shp.plot(ax = ax, color='None', edgecolor = \"k\")\r\nwhale_habitat.plot(ax = ax, edgecolor = \"purple\", facecolor = 'none')\r\nax.set_title('Whale Habitat', fontsize=12)\r\nax.ticklabel_format(scilimits =  [-5, 5])\r\nctx.add_basemap(ax, crs = projected_EPSG)\r\npngwhale_habitat_diff = whale_habitat.difference(dominica_shp)\r\nwhale_habitat = gpd.GeoDataFrame(geometry = whale_habitat_diff)\r\nwhale_habitat\r\n\r\n\r\n    .dataframe tbody tr th:only-of-type {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .dataframe tbody tr th {\r\n        vertical-align: top;\r\n    }\r\n\r\n    .dataframe thead th {\r\n        text-align: right;\r\n    }\r\n\r\n\r\n\r\ngeometry\r\n\r\n\r\n0\r\n\r\n\r\nPOLYGON ((456480.652 1682792.746, 454480.652 1…\r\n\r\n\r\nfig, ax = plt.subplots(figsize = (10, 10))\r\nax.grid(True, color = 'dimgray')\r\nax.set(xlim=(4.4e5, 4.85e5), ylim=(1.675e6, 1.73e6))\r\ndominica_shp.plot(ax = ax, color='None', edgecolor = \"k\")\r\nwhale_habitat.plot(ax = ax, edgecolor = \"purple\", facecolor = 'none')\r\nax.set_title('Whale Habitat', fontsize=12)\r\nax.ticklabel_format(scilimits =  [-5, 5])\r\nctx.add_basemap(ax, crs = projected_EPSG)\r\npngwhale_habitat\r\n\r\n\r\n    .dataframe tbody tr th:only-of-type {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .dataframe tbody tr th {\r\n        vertical-align: top;\r\n    }\r\n\r\n    .dataframe thead th {\r\n        text-align: right;\r\n    }\r\n\r\n\r\n\r\ngeometry\r\n\r\n\r\n0\r\n\r\n\r\nPOLYGON ((456480.652 1682792.746, 454480.652 1…\r\n\r\n\r\nLoad AIS Vessel Data\r\nvessels = gpd.read_file(vessels_CSV)\r\npoints = gpd.points_from_xy(vessels['LON'], vessels['LAT'], crs = geodetic_EPSG)\r\nCreate GeoDataFrame\r\nvessels_gdf = gpd.GeoDataFrame(vessels, geometry = points)\r\nvessels_gdf\r\n\r\n\r\n    .dataframe tbody tr th:only-of-type {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .dataframe tbody tr th {\r\n        vertical-align: top;\r\n    }\r\n\r\n    .dataframe thead th {\r\n        text-align: right;\r\n    }\r\n\r\n\r\n\r\nfield_1\r\n\r\n\r\nMMSI\r\n\r\n\r\nLON\r\n\r\n\r\nLAT\r\n\r\n\r\nTIMESTAMP\r\n\r\n\r\ngeometry\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n233092000\r\n\r\n\r\n-61.84788\r\n\r\n\r\n15.23238\r\n\r\n\r\n2015-05-22 13:53:26\r\n\r\n\r\nPOINT (-61.84788 15.23238)\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n255803280\r\n\r\n\r\n-61.74397\r\n\r\n\r\n15.96114\r\n\r\n\r\n2015-05-22 13:52:57\r\n\r\n\r\nPOINT (-61.74397 15.96114)\r\n\r\n\r\n2\r\n\r\n\r\n2\r\n\r\n\r\n329002300\r\n\r\n\r\n-61.38968\r\n\r\n\r\n15.29744\r\n\r\n\r\n2015-05-22 13:52:32\r\n\r\n\r\nPOINT (-61.38968 15.29744)\r\n\r\n\r\n3\r\n\r\n\r\n3\r\n\r\n\r\n257674000\r\n\r\n\r\n-61.54395\r\n\r\n\r\n16.2334\r\n\r\n\r\n2015-05-22 13:52:24\r\n\r\n\r\nPOINT (-61.54395 16.23340)\r\n\r\n\r\n4\r\n\r\n\r\n4\r\n\r\n\r\n636092006\r\n\r\n\r\n-61.52401\r\n\r\n\r\n15.81954\r\n\r\n\r\n2015-05-22 13:51:23\r\n\r\n\r\nPOINT (-61.52401 15.81954)\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n617257\r\n\r\n\r\n238722\r\n\r\n\r\n256525000\r\n\r\n\r\n-61.40679\r\n\r\n\r\n15.36907\r\n\r\n\r\n2015-05-21 21:34:59\r\n\r\n\r\nPOINT (-61.40679 15.36907)\r\n\r\n\r\n617258\r\n\r\n\r\n238723\r\n\r\n\r\n311077100\r\n\r\n\r\n-61.37539\r\n\r\n\r\n15.27406\r\n\r\n\r\n2015-05-21 21:34:55\r\n\r\n\r\nPOINT (-61.37539 15.27406)\r\n\r\n\r\n617259\r\n\r\n\r\n238724\r\n\r\n\r\n377907247\r\n\r\n\r\n-61.39461\r\n\r\n\r\n15.30672\r\n\r\n\r\n2015-05-21 21:34:46\r\n\r\n\r\nPOINT (-61.39461 15.30672)\r\n\r\n\r\n617260\r\n\r\n\r\n238725\r\n\r\n\r\n253365000\r\n\r\n\r\n-61.49001\r\n\r\n\r\n16.14007\r\n\r\n\r\n2015-05-21 21:34:46\r\n\r\n\r\nPOINT (-61.49001 16.14007)\r\n\r\n\r\n617261\r\n\r\n\r\n238726\r\n\r\n\r\n329002300\r\n\r\n\r\n-61.48073\r\n\r\n\r\n15.44751\r\n\r\n\r\n2015-05-21 21:34:45\r\n\r\n\r\nPOINT (-61.48073 15.44751)\r\n\r\n\r\n617262 rows × 6 columns\r\n\r\n\r\nSet CRS\r\nvessels_gdf = vessels_gdf.to_crs(projected_EPSG)\r\nMake TIMESTAMP datetime\r\nvessels_gdf['TIMESTAMP'] = pd.to_datetime(vessels_gdf['TIMESTAMP'])\r\nSelect Vessels Inside Whale Habitat\r\nvessels_whale = vessels_gdf.sjoin(whale_habitat, how = 'inner')\r\nvessels_whale\r\n\r\n\r\n    .dataframe tbody tr th:only-of-type {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .dataframe tbody tr th {\r\n        vertical-align: top;\r\n    }\r\n\r\n    .dataframe thead th {\r\n        text-align: right;\r\n    }\r\n\r\n\r\n\r\nfield_1\r\n\r\n\r\nMMSI\r\n\r\n\r\nLON\r\n\r\n\r\nLAT\r\n\r\n\r\nTIMESTAMP\r\n\r\n\r\ngeometry\r\n\r\n\r\nindex_right\r\n\r\n\r\n2\r\n\r\n\r\n2\r\n\r\n\r\n329002300\r\n\r\n\r\n-61.38968\r\n\r\n\r\n15.29744\r\n\r\n\r\n2015-05-22 13:52:32\r\n\r\n\r\nPOINT (464555.392 1690588.725)\r\n\r\n\r\n0\r\n\r\n\r\n7\r\n\r\n\r\n7\r\n\r\n\r\n338143127\r\n\r\n\r\n-61.39575\r\n\r\n\r\n15.33418\r\n\r\n\r\n2015-05-22 13:50:54\r\n\r\n\r\nPOINT (463892.452 1694650.397)\r\n\r\n\r\n0\r\n\r\n\r\n13\r\n\r\n\r\n13\r\n\r\n\r\n329002300\r\n\r\n\r\n-61.38968\r\n\r\n\r\n15.29745\r\n\r\n\r\n2015-05-22 13:48:32\r\n\r\n\r\nPOINT (464555.389 1690589.831)\r\n\r\n\r\n0\r\n\r\n\r\n15\r\n\r\n\r\n15\r\n\r\n\r\n338143015\r\n\r\n\r\n-61.39558\r\n\r\n\r\n15.33423\r\n\r\n\r\n2015-05-22 13:47:31\r\n\r\n\r\nPOINT (463910.683 1694655.978)\r\n\r\n\r\n0\r\n\r\n\r\n16\r\n\r\n\r\n16\r\n\r\n\r\n338143127\r\n\r\n\r\n-61.39757\r\n\r\n\r\n15.33139\r\n\r\n\r\n2015-05-22 13:47:25\r\n\r\n\r\nPOINT (463697.964 1694341.275)\r\n\r\n\r\n0\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n…\r\n\r\n\r\n617252\r\n\r\n\r\n238717\r\n\r\n\r\n329002300\r\n\r\n\r\n-61.4885\r\n\r\n\r\n15.4706\r\n\r\n\r\n2015-05-21 21:37:45\r\n\r\n\r\nPOINT (453901.647 1709712.916)\r\n\r\n\r\n0\r\n\r\n\r\n617253\r\n\r\n\r\n238718\r\n\r\n\r\n338143015\r\n\r\n\r\n-61.39553\r\n\r\n\r\n15.33448\r\n\r\n\r\n2015-05-21 21:37:14\r\n\r\n\r\nPOINT (463915.972 1694683.643)\r\n\r\n\r\n0\r\n\r\n\r\n617255\r\n\r\n\r\n238720\r\n\r\n\r\n338143127\r\n\r\n\r\n-61.39563\r\n\r\n\r\n15.33468\r\n\r\n\r\n2015-05-21 21:35:12\r\n\r\n\r\nPOINT (463905.177 1694705.734)\r\n\r\n\r\n0\r\n\r\n\r\n617259\r\n\r\n\r\n238724\r\n\r\n\r\n377907247\r\n\r\n\r\n-61.39461\r\n\r\n\r\n15.30672\r\n\r\n\r\n2015-05-21 21:34:46\r\n\r\n\r\nPOINT (464023.288 1691613.624)\r\n\r\n\r\n0\r\n\r\n\r\n617261\r\n\r\n\r\n238726\r\n\r\n\r\n329002300\r\n\r\n\r\n-61.48073\r\n\r\n\r\n15.44751\r\n\r\n\r\n2015-05-21 21:34:45\r\n\r\n\r\nPOINT (454741.236 1707161.130)\r\n\r\n\r\n0\r\n\r\n\r\n167402 rows × 7 columns\r\n\r\n\r\nPlot Vessel Data\r\nfig, ax = plt.subplots(figsize = (10, 10))\r\nax.grid(True, color = 'dimgray')\r\nax.set(xlim=(4.4e5, 4.85e5), ylim=(1.675e6, 1.73e6))\r\ndominica_shp.plot(ax = ax, color='None', edgecolor = \"k\")\r\nvessels_whale.plot(ax = ax, markersize = .1, color = \"purple\", alpha = .1)\r\nax.set_title('Vessel Data Inside Whale Habitat', fontsize=12)\r\nax.ticklabel_format(scilimits =  [-5, 5])\r\nctx.add_basemap(ax, crs = projected_EPSG)\r\npngCalculate Vessel Speeds\r\nSort\r\nvessels_whale_sorted = vessels_whale.sort_values(['MMSI', 'TIMESTAMP'])\r\nMake Copy and Shift\r\nvessels_whale_shifted = vessels_whale_sorted.shift(periods = 1)\r\nJoin Sorted With Shifted\r\nvw_sorted_shifted = vessels_whale_sorted.join(vessels_whale_shifted, lsuffix = \"_original\", rsuffix = \"_copy\")\r\nMatch MMSI Numbers\r\nvw_matched = vw_sorted_shifted[vw_sorted_shifted['MMSI_original'] == vw_sorted_shifted['MMSI_copy']]\r\nSet Geometires\r\nvw_matched = vw_matched.set_geometry(col = vw_matched['geometry_original'], crs = projected_EPSG)\r\nFind the Distance (in meters - m)\r\nvw_matched['distance_m'] = vw_matched['geometry_original'].distance(vw_matched['geometry_copy']) \r\nFind the Elapsed Time (seconds - s)\r\nvw_matched['time_s'] = vw_matched['TIMESTAMP_original'] - vw_matched['TIMESTAMP_copy']\r\nvw_matched['time_s'] = vw_matched['time_s'].dt.total_seconds() \r\nFind the Speed (meters per seconds - ms)\r\nvw_matched['speed_ms'] = vw_matched['distance_m'] / vw_matched['time_s']\r\nvw_matched['10_kn_time'] = vw_matched['distance_m'] / ten_kn_in_ms\r\nvw_matched['time_diff'] = vw_matched['10_kn_time'].sub(vw_matched['time_s'])\r\nvw_matched = vw_matched[vw_matched['time_diff'] > 0]\r\nPlot Vessels travelling over 10 knots\r\nfig, ax = plt.subplots(figsize = (10, 10))\r\nax.grid(True, color = 'dimgray')\r\nax.set(xlim=(4.4e5, 4.85e5), ylim=(1.675e6, 1.73e6))\r\ndominica_shp.plot(ax = ax, color='None', edgecolor = \"k\")\r\nvw_matched.plot(ax = ax, markersize = .1, color = \"purple\", alpha = .25)\r\nax.set_title('Vessel Data Inside Whale Habitat', fontsize=12)\r\nax.ticklabel_format(scilimits =  [-5, 5])\r\nctx.add_basemap(ax, crs = projected_EPSG)\r\npngView Summary Stats\r\nvw_matched[['distance_m', 'time_s', 'speed_ms']].describe()\r\n\r\n\r\n    .dataframe tbody tr th:only-of-type {\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .dataframe tbody tr th {\r\n        vertical-align: top;\r\n    }\r\n\r\n    .dataframe thead th {\r\n        text-align: right;\r\n    }\r\n\r\n\r\n\r\ndistance_m\r\n\r\n\r\ntime_s\r\n\r\n\r\nspeed_ms\r\n\r\n\r\ncount\r\n\r\n\r\n21282.000000\r\n\r\n\r\n21282.000000\r\n\r\n\r\n2.128200e+04\r\n\r\n\r\nmean\r\n\r\n\r\n1602.087151\r\n\r\n\r\n198.250728\r\n\r\n\r\ninf\r\n\r\n\r\nstd\r\n\r\n\r\n1473.334485\r\n\r\n\r\n187.465984\r\n\r\n\r\nNaN\r\n\r\n\r\nmin\r\n\r\n\r\n64.542545\r\n\r\n\r\n0.000000\r\n\r\n\r\n5.140343e+00\r\n\r\n\r\n25%\r\n\r\n\r\n838.258302\r\n\r\n\r\n120.000000\r\n\r\n\r\n5.949960e+00\r\n\r\n\r\n50%\r\n\r\n\r\n1150.938066\r\n\r\n\r\n141.000000\r\n\r\n\r\n6.826952e+00\r\n\r\n\r\n75%\r\n\r\n\r\n1805.137371\r\n\r\n\r\n181.000000\r\n\r\n\r\n8.696041e+00\r\n\r\n\r\nmax\r\n\r\n\r\n28330.585863\r\n\r\n\r\n4085.000000\r\n\r\n\r\ninf\r\n\r\n\r\nImpact of a 10 knot Speed Reduction Zone\r\nWe calculated that ship vessel traffic would be slowed by 2 minutes per mile on average. Over the course of the year, this equated to approximately 28 days of increased shipping time.\r\nnum_days = vw_matched['time_diff'].sum() / 60 / 60 /24\r\nnum_days\r\n27.9423247732646\r\nmean_time_lost = vw_matched['time_diff'].mean() / 60\r\nmean_time_lost\r\n1.8906563139508044\r\n\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2021-12-03T08:23:06-08:00",
    "input_file": "protecting-whales-from-ships.knit.md"
  },
  {
    "path": "posts/2021-12-01-eds-222-final-project-species-density-sst/",
    "title": "Species Density ~ SST + lag(SST)\n",
    "description": {},
    "author": [
      {
        "name": "Cullen Molitor",
        "url": {}
      }
    ],
    "date": "2021-12-01",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nMotivation\r\nData\r\nAnalysis\r\nResults\r\nCold-water species\r\nWarm-water species\r\n\r\nFuture Work\r\nBetter Models\r\nMore Protocols/Species\r\nIntegrate Program Data\r\n\r\nCode Availability\r\nLiterature Cited\r\n\r\nMotivation\r\nCalifornia’s Northern Channel Islands sit at the transition between two biogeographic provinces, the cold-water North Pacific and the warm-water Gulf of California. San Miguel and Santa Rosa Islands have species representative of the North Pacific province while Anacapa and Santa Barbara Islands sit firmly in the Gulf of California province. Santa Cruz Island lies in the transition zone with the western end of the island favoring North Pacific species and the eastern end favoring Gulf of California species. This makes the Northern Channel Islands a unique place to study how species distribution and recruitment respond to ocean temperatures.\r\n\r\n\r\nhide\r\n\r\nknitr::include_graphics(\"biogeo.png\")\r\n\r\n\r\n\r\n\r\n      Figure 1. The Southern California Bight (SCB) shown with a composite sea\r\n      surface temperatures (SST) color gradient for 2009. This SST is typical of\r\n      the region and illustrates the transition between the North Pacific and Gulf\r\n      of California biogegeographic provinces (Image taken from Freedman 2020).\r\n\r\nThe El Niño Southern Oscillation (ENSO) is measured primarily by the Oceanic Niño Index which calculates a SST anomaly value value each month going back to 1950. These values are derived from SST in the equatorial pacific (\\(\\pm5^{\\circ}\\) latitude, \\(120^{\\circ}-170^{\\circ}W\\) longitude). The patterns of SST in this region are responsible for driving certain global weather and climate patterns. Despite the distance from this region, ENSO has a large effect on the oceanographic conditions of the SCB and the Channel Islands. This effect includes an influence on local SST as well as the strength and direction of ocean currents. These effects are known to influence the distribution and abundance of certain marine species (Day 2018, Freedman 2020).\r\nThis analysis takes a shotgun approach to investigate which species are sensitive to either warm-water or cold-water events by using a series of species-level dynamic linear models with lag SST anomalies as predictor variables. These models will provide a broad overview of which species are affected, how they are affected, and whether or not the affect is statistically significant. This will inform our understanding of how species distribution and population ranges might be affected by changing oceanographic conditions due to climate change.\r\nData\r\nThe Kelp Forest Monitoring (KFM) program at Channel Islands National Park has been collecting abundance and size distribution data of more than 170 species since 1982 (sampled annually). The park currently samples 33 sites at the five islands in the National Park. This data is publicly available and was requested and issued under a scientific research and collecting permit (permit #: CHIS-2020-SCI-0006). These data are collected using scuba surveys where the biologists attempt to minimize their impact on the reef by using non-invasive sampling methods. This means that animals are counted in situ and no rocks are overturned or species removed. This inevitably biases the data towards adult populations of certain invertebrates that utilize crevice habitat during development as they will be hidden from direct observation.\r\nThe fish data is collected in (#\\(/m^3\\)). In order to assure that all data are in the same units, only measurements of invertebrate and algae density (#\\(/m^2\\)) are retained. This takes the total number of species with density data from 151 down to 35. Using species density, we can identify trends in abundance observed over multiple El Niño (warm-water) and La Niña (cold-water) events. Using a dynamic linear model with lag independent variables we can see the effect of sea surface temperature anomalies during and in the years following these events on species density.\r\nBelow we read in ENSO data and calculate yearly mean anomalies before making 5 new columns with corresponding lag values. We then load in the species density data and filter out fish and 2 species which are exceedingly rare and do not have enough data to model. This leaves us with 33 species to model, all with the same units.\r\n\r\n\r\nhide\r\n\r\n# Load libraries\r\nlibrary(tidyverse)\r\nlibrary(here)\r\nlibrary(lubridate)\r\nlibrary(broom)\r\nlibrary(arrow)\r\nlibrary(plotly)\r\n\r\n# Load and Tidy Data\r\noni_yearly <-  # Read in Oceanic Nino Index region 3.4 data\r\n  read.table(\r\n    \"https://origin.cpc.ncep.noaa.gov/products/analysis_monitoring/ensostuff/detrend.nino34.ascii.txt\",\r\n    header = T) %>%\r\n  # rename YR for joining tables\r\n  dplyr::rename(SurveyYear = YR) %>% \r\n  dplyr::group_by(SurveyYear) %>% \r\n  # Calculate yearly SST Anom\r\n  dplyr::summarise(SST_Anom = mean(ANOM)) %>% \r\n  # Create lagged SST\r\n  dplyr::mutate(SST_Anom_1 = lag(SST_Anom, n = 1),\r\n                SST_Anom_2 = lag(SST_Anom, n = 2),\r\n                SST_Anom_3 = lag(SST_Anom, n = 3),\r\n                SST_Anom_4 = lag(SST_Anom, n = 4),\r\n                SST_Anom_5 = lag(SST_Anom, n = 5))\r\n\r\n\r\ndensity <-  # Read in Density data\r\n  arrow::read_feather(\"Density.feather\") %>%\r\n  dplyr::filter(Classification != \"Fish\",\r\n                !CommonName %in% c(\"wakame, adult\", \r\n                                   \"wakame, juvenile\", \r\n                                   \"white abalone\")) %>% \r\n  dplyr::left_join(oni_yearly)\r\n\r\n\r\n\r\nAnalysis\r\nThis analysis will use a general model formula of lm(Mean_Density ~ SST_Anom + SST_Anom_1 + SST_Anom_2 + SST_Anom_3 + SST_Anom_4 + SST_Anom_5) applied to density data grouped by each species scientific name. These five lag periods will show how a species is affected within the same year, and for the next five years following anomalous warm or cold water. We expect recruitment of certain species will either increases or decreases following warmer than usual or colder than usual ocean temperatures. Given what we know about the life cycle of many marine species, it is reasonable to assume these effects would not be detected by non-invasive sampling techniques for 1-5 years following anomalous temperatures.\r\nThis analysis is simplified to detect trends in a large number of species and does not take into account the effect of biogeography. This also does not consider the impact of marine protected areas (MPAs) which potentially buffer the ecological community from the effects of abiotic factors such as SST. MPAs could also have an effect from increased predation to some of these species, potentially limiting their abundance.\r\nThe cumulative effect on all species will be plotted. Then the results will be filtered to only include significant affects and sorted by the estimated slope of their relationship. The two species with the most positive slope and the two with the most negative slope will have their coefficients plotted over the lag periods.\r\n\r\n\r\nhide\r\n\r\nResults_lag <- density %>% \r\n  dplyr::group_by(ScientificName) %>%\r\n  dplyr::summarise(\r\n    generics::tidy(\r\n      stats::lm(\r\n        Mean_Density ~ SST_Anom + SST_Anom_1 + SST_Anom_2 + SST_Anom_3 + SST_Anom_4 + SST_Anom_5\r\n        ))) %>% \r\n  dplyr::filter(term != \"(Intercept)\") %>% \r\n  dplyr::mutate(significant = ifelse(p.value <= .05, \"yes\", \"no\"))\r\n\r\n\r\n\r\nResults\r\n\r\n\r\nhide\r\n\r\nResults_filtered <- Results_lag %>%\r\n  dplyr::filter(p.value <= .05) %>% \r\n  dplyr::arrange(estimate) %>%\r\n  dplyr::mutate(statistic = round(statistic, 3),\r\n                p.value = round(p.value, 3),\r\n                p.value = ifelse(p.value < 0.001, \"< 0.001\", as.character(p.value))) \r\ncold_sp <- Results_filtered %>% \r\n  arrange(estimate) %>% \r\n  distinct(ScientificName) %>% \r\n  head(3) %>% \r\n  pull()\r\n\r\nwarm_sp <- Results_filtered %>% \r\n  arrange(desc(estimate)) %>% \r\n  distinct(ScientificName) %>% \r\n  head(3) %>% \r\n  pull()\r\n\r\ncold <- Results_lag %>% \r\n  group_by(ScientificName) %>% \r\n  mutate(cum_est = cumsum(estimate)) %>% \r\n  filter(ScientificName %in% cold_sp)\r\n\r\nwarm <- Results_lag %>% \r\n  group_by(ScientificName) %>% \r\n  mutate(cum_est = cumsum(estimate)) %>% \r\n  filter(ScientificName %in% warm_sp)\r\n\r\nplt <- function(.data = cold) {\r\n  ggplot(data = .data, aes(x = term, y = cum_est)) +\r\n    geom_line(aes(color = ScientificName, group = ScientificName), size = 1) +\r\n    geom_point(aes(shape = significant), size = 4) +\r\n    scale_y_continuous(expand = c(0, 1)) +\r\n    scale_x_discrete(labels = c(\"Current Year\", \"+1\", \"+2\", \"+3\", \"+4\", \"+5\")) +\r\n    scale_color_viridis_d(option = \"D\", end = .75, direction = -1) +\r\n    labs(x = \"Years relative to SST anomaly exposure\", y = \"Cumulative effect (sum of coefficients)\",\r\n         shape = \"P-Val < .05?\", color = \"Species\") +\r\n    theme_classic() \r\n}\r\n\r\n\r\n\r\nCold-water species\r\nThe two species with the largest negative cumulative effect were identified as Strongylocentrotus purpuratus (purple sea urchin) and Strongylocentrotus franciscanus (red sea urchin). Purple sea urchin seem to have the most extreme negative coefficients, suggesting that this species thrives under cold-water conditions. Red sea urchins have a similar though less extreme response to cold-water conditions. In both urchin species, the effect is significant in the same year, as well as the year following cold-water conditions. This makes sense, because despite non-invasive sampling, juvenile sea urchins as small as 1 mm have been recorded by KFM observers.\r\nPatiria miniata (bat star) had the third most negative cumulative effect. This species is particularly affected by warm water, which tends to cause a form of sea star wasting disease (SSWD). Bat star populations take years to rebound following SSWD events. This slow recovery is seen in the cumulative effect which is statistically significant for the current period and for the following four years.\r\n\r\n\r\nhide\r\n\r\nplt()\r\n\r\n\r\n\r\n\r\n      Figure 2. The cumulative effect that SST anomalies have on the three species\r\n      which have the largest negative slope estimates of all statistically significant\r\n      results. The effect accumulates from the current year to the following 5 years.\r\n\r\nWarm-water species\r\nSargassum horneri (devil weed) had the single most positive cumulative effect of any species. This is an invasive algae that has spread rapidly at the Channel Islands since its introduction to Catalina island in 2006 (Miller 2007). Predicting what factors contribute to the spread of S. horneri will help scientist understand where to expect it next and what impacts it might have on the ecologic communities it settles in. Only the current year is seen to be positive, suggesting that S. horneri juveniles are largely responsible for the effect.\r\nMegastaea undosa (wavy turban snail) is an important grazing snail that is known to spawn in warm-water conditions which means that ENSO may be helpful in setting harvest quotas (Zacharias 2006). The effect is only significant 2, 3, and 4 years following a warm water event. I would argue that these snails spawn late in the year when the water is warmest and the sampling season is coming to a close. The following year, the juvenile snails are most likely missed as they are too cryptic. Then during the 2nd, 3rd, and 4th year, these animals are largest enough to be observed reliably.\r\nLytechinus anamesus likely follow the same pattern as M. undosa. I would be interested to investigate MPA effects on these lobster and sheephead snack-sized sea urchin (<40 mm typically).\r\n\r\n\r\nhide\r\n\r\nplt(.data = warm)\r\n\r\n\r\n\r\n\r\n      Figure 3. The cumulative effect that SST anomalies have on the three species\r\n      which have the largest positive slope estimates of all statistically significant\r\n      results. The effect accumulates from the current year to the following 5 years.\r\n\r\nFuture Work\r\nBetter Models\r\nInclude biogeogrphic regions to see how species abundance is affected by region. I would also like to include MPA status to identify if there are any buffer effects provided by the MPA, or impacts to prey species from increased preddation.\r\nMore Protocols/Species\r\nThis analysis only uses 2 out of 13 sampling protocols of the KFM program. The analysis could be expanded to include data from the two fish surveys, as well as percent cover data from random point contacts survey.\r\nIntegrate Program Data\r\nThis analysis could be made more robust by including data from the Partnership for Interdisciplinary Study of Coastal Oceans (PISCO), which conducts similar monitoring efforts around the Channel Islands.\r\nCode Availability\r\nGitHub Repository with all code and data available at this link.\r\nLiterature Cited\r\nCostello, M.J., Tsai, P., Wong, P.S. et al. Marine biogeographic realms and species endemicity. Nat Commun 8, 1057 (2017). https://doi.org/10.1038/s41467-017-01121-2\r\nDay, P. B., Stuart-Smith, R. D., Edgar, G. J. & Bates, A. E. Species’ thermal ranges predict changes in reef fish community structure during 8 years of extreme temperature variation. Divers. Distrib. 24, 1036–1046 (2018).\r\nFreedman, R.M., Brown, J.A., Caldow, C. et al. Marine protected areas do not prevent marine heatwave-induced fish community structure changes in a temperate transition zone. Sci Rep 10, 21081 (2020). https://doi.org/10.1038/s41598-020-77885-3\r\nHorta e Costa, B. Tropicalization of fish assemblages in temperate biogeographic transition zones. Mar. Ecol. Prog. Ser. 504, 241–252 (2014).\r\nMiller, K. A., Engle, J. M., Uwai, S., & Kawai, H. (2007). First report of the asian seaweed sargassum filicinum harvey (fucales) in california, usa. Biological Invasions, (9), 609-613.\r\nWernberg, T. S. et al. Climate-driven regime shift of a temperate marine ecosystem. Science 353, 169–172 (2016).\r\nZacharias, Mark, and David J. Kushner. 2006. “Sea temperature and wave height as predictors of population size structure and density of Megastraea (Lithopoma) undosa: Implications for fishery management.” Bulletin of Marine Science 79.1: 71-82.\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-12-01-eds-222-final-project-species-density-sst/biogeo.png",
    "last_modified": "2021-12-02T16:12:34-08:00",
    "input_file": {}
  }
]
